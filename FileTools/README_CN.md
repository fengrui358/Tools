# 文件清理工具 (file_cleanup.py)

这是一个Python脚本工具，用于扫描指定文件夹，检测并删除重复文件和空文件夹，同时记录详细的操作日志。

## 功能特性

- ✅ 递归扫描指定文件夹及其所有子文件夹
- ✅ 使用SHA256哈希算法高效检测重复文件
- ✅ 自动删除重复文件（只保留一个副本）
- ✅ 检测并删除所有空文件夹
- ✅ 详细的日志记录，包括操作时间和结果统计
- ✅ 预览模式，可在实际执行前查看将要执行的操作
- ✅ 错误处理和异常捕获
- ✅ 跨平台支持（Windows/Linux/macOS）

## 安装要求

- Python 3.6 或更高版本
- 不需要额外安装依赖库（使用Python标准库）

## 使用方法

### 基本用法
```bash
python file_cleanup.py "C:\目标文件夹"
```

### 指定日志文件路径
```bash
python file_cleanup.py "D:\Documents" --log "C:\Logs\清理日志.log"
```

### 预览模式（不实际执行删除操作）
```bash
python file_cleanup.py "E:\测试文件夹" --dry-run
```

### 使用简写参数
```bash
python file_cleanup.py "/path/to/folder" -l "/path/to/logfile.log" -d
```

## 参数说明

| 参数 | 说明 | 是否必需 | 默认值 |
|------|------|----------|--------|
| `path` | 要扫描的目标文件夹路径 | 是 | 无 |
| `--log`, `-l` | 日志文件保存路径 | 否 | file_cleanup.log |
| `--dry-run`, `-d` | 预览模式开关，只显示操作不实际执行 | 否 | false |

## 算法原理

### 重复文件检测
1. 使用SHA256哈希算法计算每个文件的数字指纹
2. 哈希值相同的文件被认为是重复文件
3. 保留每个重复文件组中的第一个文件，删除其他文件

### 空文件夹检测
1. 从最深层的文件夹开始向上扫描
2. 检查每个文件夹是否包含任何文件或子文件夹
3. 删除所有空文件夹（包括嵌套的空文件夹）

## 安全注意事项

1. **备份重要数据**: 在执行删除操作前，请确保已备份重要文件
2. **预览模式**: 首次使用时建议使用 `--dry-run` 参数预览将要执行的操作
3. **权限要求**: 脚本需要足够的文件系统权限来读取和删除文件

## 日志格式

日志文件包含以下信息：
- 时间戳和日志级别（INFO/WARNING/ERROR）
- 扫描的文件数量统计
- 发现的重复文件详情
- 删除的文件和节省的空间
- 删除的空文件夹信息
- 任何错误或异常信息

## 示例输出

```
2025-09-20 19:05:30 [INFO] ============================================================
2025-09-20 19:05:30 [INFO] 文件清理工具启动
2025-09-20 19:05:30 [INFO] 目标路径: C:\TestFolder
2025-09-20 19:05:30 [INFO] 日志文件: file_cleanup.log
2025-09-20 19:05:30 [INFO] ============================================================
2025-09-20 19:05:30 [INFO] 开始扫描文件...
2025-09-20 19:05:32 [INFO] 已扫描 100 个文件...
2025-09-20 19:05:35 [INFO] 扫描完成，共发现 152 个文件
2025-09-20 19:05:35 [INFO] 发现 3 组重复文件，共 6 个重复文件
2025-09-20 19:05:35 [INFO] 开始处理重复文件...
2025-09-20 19:05:35 [INFO] 已删除重复文件: C:\TestFolder\file2.txt (与 C:\TestFolder\file1.txt 相同)
2025-09-20 19:05:35 [INFO] 共删除 3 个重复文件，节省空间: 4.25 MB
2025-09-20 19:05:35 [INFO] 开始扫描空文件夹...
2025-09-20 19:05:35 [INFO] 发现 2 个空文件夹
2025-09-20 19:05:35 [INFO] 开始删除空文件夹...
2025-09-20 19:05:35 [INFO] 已删除空文件夹: C:\TestFolder\empty_folder
2025-09-20 19:05:35 [INFO] 共删除 2 个空文件夹
2025-09-20 19:05:35 [INFO] ============================================================
2025-09-20 19:05:35 [INFO] 清理完成统计:
2025-09-20 19:05:35 [INFO] 总文件数: 152
2025-09-20 19:05:35 [INFO] 发现的重复文件: 6
2025-09-20 19:05:35 [INFO] 删除的重复文件: 3
2025-09-20 19:05:35 [INFO] 节省的空间: 4.25 MB
2025-09-20 19:05:35 [INFO] 删除的空文件夹: 2
2025-09-20 19:05:35 [INFO] ============================================================
```

## 性能优化

- **分块读取**: 大文件分块读取，避免内存溢出
- **进度显示**: 每处理100个文件显示进度信息
- **高效算法**: 使用哈希表快速查找重复文件
- **批量处理**: 空文件夹批量删除，减少IO操作

## 错误处理

脚本包含完善的错误处理机制：
- 文件权限错误
- 路径不存在错误
- 磁盘空间不足错误
- 网络连接错误（网络驱动器）
- 其他意外异常

## 跨平台支持

该脚本支持所有主要操作系统：
- Windows
- Linux
- macOS

## 故障排除

### 权限错误
```bash
# Windows: 以管理员身份运行
python file_cleanup.py "C:\目标文件夹"

# Linux/macOS: 使用sudo
sudo python file_cleanup.py "/目标文件夹"
```

### Python版本问题
确保使用Python 3.6或更高版本：
```bash
python --version
```

### 文件路径问题
在Windows中使用反斜杠或正斜杠：
```bash
python file_cleanup.py "C:/目标文件夹"
python file_cleanup.py "C:\目标文件夹"
```

## 源代码结构

```
file_cleanup.py
├── FileCleanupTool 类
│   ├── __init__() - 初始化工具
│   ├── setup_logging() - 设置日志
│   ├── calculate_file_hash() - 计算文件哈希
│   ├── scan_files() - 扫描文件
│   ├── find_duplicates() - 查找重复文件
│   ├── remove_duplicates() - 删除重复文件
│   ├── find_empty_folders() - 查找空文件夹
│   ├── remove_empty_folders() - 删除空文件夹
│   └── run() - 运行主流程
└── main() - 命令行入口
```

## 许可证

MIT License - 可自由使用和修改
